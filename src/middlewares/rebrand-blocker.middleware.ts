import { Context as TelegrafContext } from 'telegraf';

const NEW_BOT_ID = 8252040138;
let botId: number | null = null;

export function rebrandBlocker() {
  return async (ctx: TelegrafContext, next: () => Promise<void>) => {
    // –ü–æ–ª—É—á–∞–µ–º bot ID –æ–¥–∏–Ω —Ä–∞–∑
    if (botId === null) {
      const botInfo = await ctx.telegram.getMe();
      botId = botInfo.id;
    }

    // –ï—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤—ã–π –±–æ—Ç - –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
    if (botId === NEW_BOT_ID) {
      return next();
    }

    // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞—Ä—ã–π –±–æ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ö–ê–ñ–î–´–ô –†–ê–ó –∏ –ù–ï –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
    if (ctx.from) {
      await ctx.reply(
        '‚ö†Ô∏è <b>–í–∞–∂–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–±—Ä–µ–Ω–¥–∏–Ω–≥–µ</b>\n\n' +
          '–í —Ä–∞–º–∫–∞—Ö —Ä–µ–±—Ä–µ–Ω–¥–∏–Ω–≥–∞ –∏ –æ—Ç–∫–∞–∑–∞ –æ—Ç –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π —Å –∫–æ–º–ø–∞–Ω–∏–µ–π –∫–æ—Ç–æ—Ä—É—é –Ω–µ–ª—å–∑—è –Ω–∞–∑—ã–≤–∞—Ç—å —Å–º–µ–Ω–∏–ª–∏—Å—å –¥–æ–º–µ–Ω—ã –∏ –±–æ—Ç.\n\n' +
          'üåê <b>–ù–æ–≤—ã–µ –∞–¥—Ä–µ—Å–∞:</b>\n' +
          '‚Ä¢ –°–∞–π—Ç: https://poiskkino.dev\n' +
          '‚Ä¢ API: https://api.poiskkino.dev\n' +
          '‚Ä¢ –ë–æ—Ç: @poiskkinodev_bot\n\n' +
          '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.',
        { parse_mode: 'HTML' },
      );
    }

    // –ù–ï –≤—ã–∑—ã–≤–∞–µ–º next() - –±–ª–æ–∫–∏—Ä—É–µ–º –¥–∞–ª—å–Ω–µ–π—à—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ –±–æ—Ç–∞
  };
}
